name: Scheduled Sync Tasks

on:
  schedule:
    - cron: '0 19 * * *'
  workflow_dispatch:
env:
  DEFAULT_BRANCH: 'main'

jobs:
  trigger-workflows:
    runs-on: ubuntu-latest
    strategy:
      # è®¾ç½®ä¸º false å¯ä»¥å¹¶è¡Œè§¦å‘ï¼Œtrue åˆ™ä¸²è¡Œæ‰§è¡Œ
      max-parallel: 1
      # æŸä¸ªå¤±è´¥ä¸å½±å“å…¶ä»–çš„
      fail-fast: false
      matrix:
        workflow:
          - sync-upstream-releases.yml
          - openlist.yml
          
    
    steps:
      - name: Trigger ${{ matrix.workflow }}
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const workflow = '${{ matrix.workflow }}';
            const branch = '${{ env.DEFAULT_BRANCH }}';
            
            console.log(`ğŸš€ è§¦å‘å·¥ä½œæµ: ${workflow}`);
            console.log(`ğŸŒ¿ ç›®æ ‡åˆ†æ”¯: ${branch}`);
            
            try {
              await github.rest.actions.createWorkflowDispatch({
                owner: context.repo.owner,
                repo: context.repo.repo,
                workflow_id: workflow,
                ref: branch
              });
              console.log(`âœ… æˆåŠŸè§¦å‘: ${workflow}`);
            } catch (error) {
              console.error(`âŒ è§¦å‘å¤±è´¥: ${workflow}`);
              console.error(`é”™è¯¯ä¿¡æ¯: ${error.message}`);
              throw error;
            }
      
      - name: Wait interval
        if: matrix.workflow != 'openlist.yml'
        run: sleep 10
