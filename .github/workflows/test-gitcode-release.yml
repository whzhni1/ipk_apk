name: 测试 GitCode Release

on:
  workflow_dispatch:
    inputs:
      tag_name:
        default: 'v1.0.0'
      repo_name:
        default: 'test-release'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 获取完整历史，避免 shallow clone

      - name: 生成测试文件
        run: |
          mkdir -p files
          echo "# Test" > files/README.md
          echo "v${{ inputs.tag_name }}" > files/version.txt

      - name: 发布
        env:
          GITCODE_TOKEN: ${{ secrets.GITCODE_TOKEN }}
          REPO_NAME: ${{ inputs.repo_name }}
          TAG_NAME: ${{ inputs.tag_name }}
          UPLOAD_FILES: "files/README.md files/version.txt"
        run: |
          chmod +x .github/workflows/scripts/release-GitCode.sh
          .github/workflows/scripts/release-GitCode.sh
